-- Таблица Товар
CREATE TABLE Products (
    id INT PRIMARY KEY IDENTITY(1,1),
    name_product NVARCHAR(100) NOT NULL,
    purchase_price DECIMAL(10,2) NOT NULL CHECK (purchase_price >= 0),
    selling_price DECIMAL(10,2) NOT NULL CHECK (selling_price >= 0),
    unit NVARCHAR(10) NOT NULL CHECK (unit IN ('шт', 'кг')),
    manufacturer NVARCHAR(100),
    production_date DATE NOT NULL,
    expiration_date DATE NOT NULL,
    stock_quantity DECIMAL(10,3) NOT NULL CHECK (stock_quantity >= 0),
    CHECK (expiration_date >= production_date)
);

-- Таблица Скидочная карта
CREATE TABLE DiscountCard (
    id INT PRIMARY KEY IDENTITY(1,1),
    discount_rate DECIMAL(5,2) NOT NULL CHECK (discount_rate >= 0 AND discount_rate < 100)
);

-- Таблица Покупатель
CREATE TABLE Customer (
    id INT PRIMARY KEY IDENTITY(1,1),
    customer_fio NVARCHAR(100) NOT NULL,
    phone_number NVARCHAR(20) UNIQUE,
    card_id INT REFERENCES DiscountCard(id) ON DELETE SET NULL
);

-- Таблица Сотрудник
CREATE TABLE Employee (
    id INT PRIMARY KEY IDENTITY(1,1),
    employee_fio NVARCHAR(100) NOT NULL,
    role NVARCHAR(100) NOT NULL
);

-- Таблица Покупка (чек)
CREATE TABLE Sale (
    id INT PRIMARY KEY IDENTITY(1,1),
    sale_datetime DATETIME NOT NULL DEFAULT GETDATE(),
    total_amount DECIMAL(12,2) NOT NULL CHECK (total_amount >= 0),
    discount_amount DECIMAL(12,2) NOT NULL DEFAULT 0 CHECK (discount_amount >= 0),
    final_amount DECIMAL(12,2) NOT NULL CHECK (final_amount >= 0),
    customer_id INT REFERENCES Customer(id) ON DELETE SET NULL,
    employee_id INT NOT NULL REFERENCES Employee(id),
    CHECK (discount_amount <= total_amount),
    CHECK (final_amount = total_amount - discount_amount)
);

-- Таблица Позиция в чеке
CREATE TABLE SaleItem (
    id INT PRIMARY KEY IDENTITY(1,1),
    quantity DECIMAL(10,3) NOT NULL CHECK (quantity >= 0),
    price_per_unit DECIMAL(10,2) NOT NULL CHECK (price_per_unit >= 0),
    total_price DECIMAL(10,2) NOT NULL CHECK (total_price >= 0),
    sale_id INT NOT NULL REFERENCES Sale(id) ON DELETE CASCADE,
    product_id INT NOT NULL REFERENCES Products(id),
    CHECK (total_price = quantity * price_per_unit)
);




-- Заполнение таблицы Products (Товар)
INSERT INTO Products (name_product, purchase_price, selling_price, unit, manufacturer, production_date, expiration_date, stock_quantity) VALUES 
('Молоко Ярмолпрод 2,5%', 45.00, 67.00, 'шт', 'Ярмолпрод', '2025-09-27', '2025-10-06', 150.000),
('Хлеб Бородинский нарезка', 22.00, 45.00, 'шт', 'Хлебзавод №1', '2025-09-29', '2025-10-03', 80.000),
('Сыр Российский 45%', 250.00, 350.00, 'кг', 'Сырный двор', '2025-09-15', '2025-10-15', 25.500),
('Колбаса Докторская в/с', 320.00, 520.00, 'кг', 'Мясной стандарт', '2025-09-22', '2025-10-02', 18.750),
('Яблоки Голден', 60.00, 120.00, 'кг', 'Сады Приморья', '2025-09-10', '2025-10-10', 200.000),
('Батон Нарезной', 18.00, 35.00, 'шт', 'Хлебзавод №1', '2025-09-26', '2025-09-29', 60.000),
('Шоколад Alpen Gold молочный', 55.00, 95.00, 'шт', 'Мондэлис', '2025-06-15', '2025-12-15', 200.000),
('Кофе Jacobs Monarch 250г', 280.00, 450.00, 'шт', 'Jacobs', '2024-11-20', '2025-11-20', 45.000),
('Чай Greenfield классический', 120.00, 210.00, 'шт', 'Greenfield', '2024-12-15', '2025-12-15', 75.000),
('Сахар песок 1кг', 35.00, 65.00, 'шт', 'Русский сахар', '2024-10-01', '2025-10-01', 90.000),
('Соль поваренная 1кг', 8.00, 20.00, 'шт', 'Русская соль', '2025-09-25', '2026-09-25', 110.000),
('Масло подсолнечное Щедрое', 70.00, 120.00, 'шт', 'Щедрое', '2025-02-01', '2026-06-01', 85.000),
('Макароны Макфа рожки', 40.00, 75.00, 'шт', 'Макфа', '2024-11-10', '2025-11-10', 150.000),
('Курица охлажденная тушка', 180.00, 280.00, 'кг', 'Петелинка', '2025-09-29', '2025-10-09', 30.250),
('Свинина вырезка', 350.00, 550.00, 'кг', 'Мираторг', '2025-09-28', '2025-10-10', 15.800),
('Картофель мытый', 25.00, 45.00, 'кг', 'Овощевод', '2025-09-15', '2025-10-15', 300.000),
('Морковь свежая', 20.00, 40.00, 'кг', 'Овощевод', '2025-09-17', '2025-10-17', 180.000),
('Йогурт Активиа натуральный', 35.00, 65.00, 'шт', 'Danone', '2025-09-24', '2025-10-11', 95.000),
('Сметана 20% Простоквашино', 40.00, 75.00, 'шт', 'Простоквашино', '2025-09-22', '2025-10-12', 70.000),
('Творог 9% Домик в деревне', 50.00, 90.00, 'шт', 'Вимм-Билль-Данн', '2025-09-28', '2025-10-08', 60.000),
('Яйца куриные С0 10шт', 70.00, 110.00, 'шт', 'Петелинка', '2025-09-20', '2025-10-20', 100.000);


-- Заполнение таблицы DiscountCard (Скидочная карта)
INSERT INTO DiscountCard (discount_rate) VALUES 
(3.00), (5.00), (7.00), (10.00), (3.00), 
(4.00), (6.00), (8.00), (12.00), (4.00),
(2.00), (2.00), (2.00), (4.00), (4.00);


-- Заполнение таблицы Employee (Сотрудник)
INSERT INTO Employee (employee_fio, role) VALUES 
('Петров Иван Степанович', 'Кассир'),
('Сидорова Мария Николаевна', 'Кассир'),
('Козлов Алексей Александрович', 'Администратор'),
('Николаева Елена Сергеевна', 'Кассир'),
('Васильев Дмитрий Олегович', 'Старший кассир'),
('Федорова Ольга Семёновна', 'Кассир'),
('Иванов Максим Романович', 'Мерчандайзер'),
('Павлова Анна Константиновна', 'Кассир'),
('Смирнов Валентин Петрович', 'Администратор'),
('Орлова Татьяна Львовна', 'Кассир'),
('Морозов Виктор Михайлович', 'Грузчик'),
('Волкова Наталья Васильевна', 'Кассир'),
('Алексеев Павел Дмитриевич', 'Охранник'),
('Лебедева Юлия Харитоновна', 'Кассир'),
('Новиков Яков Андреевич', 'Уборщик');


-- Заполнение таблицы Customer (Покупатель)
INSERT INTO Customer (customer_fio, phone_number, card_id) VALUES 
('Смирнов Александр Максимович', '+79161234567', 1),
('Попова Екатерина Григорьевна', '+79202345678', 2),
('Соколов Андрей Андреевич', '+79323456789', NULL),
('Лебедева Ольга Харитоновна', '+79094567890', 3),
('Кузнецов Денис Фёдорович', '+79885678901', 4),
('Волкова Мария Павловна', '+79736789012', NULL),
('Васильев Василий Васильевич', '+79987890123', 5),
('Курочкмн Иван Степанович', '+79348901234', 6),
('Щукина Ольга Александровна', '+79119012345', NULL),
('Малькова Нина Валерьевна', '+79920123456', 7),
('Зонтиков Георгий Романович', '+79761234560', 8),
('Фонарёва Людмила Ивановна', '+79122345671', NULL),
('Зайцев Станислав Сергеевич', '+79103456782', 9),
('Егорова Марина Георгиевна', '+79834567893', 10),
('Павлов Борис Владиславович', '+79065678904', NULL);


-- Заполнение таблицы Sale (Покупка (чек))
INSERT INTO Sale (sale_datetime, total_amount, discount_amount, final_amount, customer_id, employee_id) VALUES 
(CONVERT(DATETIME, '2025-09-27 09:15:00', 120), 1850.00, 55.50, 1794.50, 1, 1),
(CONVERT(DATETIME, '2025-09-27 10:30:00', 120), 3200.00, 160.00, 3040.00, 2, 2),
(CONVERT(DATETIME, '2025-09-27 11:45:00', 120), 875.00, 0.00, 875.00, NULL, 3),
(CONVERT(DATETIME, '2025-09-27 14:20:00', 120), 1420.00, 28.40, 1391.60, 4, 1),
(CONVERT(DATETIME, '2025-09-27 16:50:00', 120), 2560.00, 128.00, 2432.00, 5, 4),
(CONVERT(DATETIME, '2025-09-28 08:30:00', 120), 980.00, 0.00, 980.00, NULL, 2),
(CONVERT(DATETIME, '2025-09-28 10:15:00', 120), 3150.00, 157.50, 2992.50, 6, 5),
(CONVERT(DATETIME, '2025-09-28 12:40:00', 120), 1680.00, 50.40, 1629.60, 7, 3),
(CONVERT(DATETIME, '2025-09-28 15:25:00', 120), 2240.00, 112.00, 2128.00, 8, 1),
(CONVERT(DATETIME, '2025-09-28 18:10:00', 120), 1320.00, 0.00, 1320.00, NULL, 4),
(CONVERT(DATETIME, '2025-09-29 09:45:00', 120), 2780.00, 139.00, 2641.00, 9, 2),
(CONVERT(DATETIME, '2025-09-29 11:20:00', 120), 950.00, 28.50, 921.50, 10, 5),
(CONVERT(DATETIME, '2025-09-29 13:55:00', 120), 1860.00, 0.00, 1860.00, NULL, 3),
(CONVERT(DATETIME, '2025-09-29 16:30:00', 120), 3420.00, 171.00, 3249.00, 11, 1),
(CONVERT(DATETIME, '2025-09-29 19:05:00', 120), 1250.00, 37.50, 1212.50, 12, 4);


-- Заполнение таблицы SaleItem (Позиция в чеке)
INSERT INTO SaleItem (sale_id, product_id, quantity, price_per_unit, total_price) VALUES 
-- Чек 1 (Смирнов Александр Максимович - карта 3%, сумма 1850 руб)
(1, 1, 2.000, 67.00, 134.00),   -- Молоко
(1, 3, 0.500, 350.00, 175.00),  -- Сыр
(1, 7, 3.000, 95.00, 285.00),   -- Шоколад
(1, 9, 1.000, 210.00, 210.00),  -- Чай
(1, 11, 2.000, 20.00, 40.00),   -- Соль
(1, 13, 2.000, 75.00, 150.00),  -- Макароны
(1, 15, 1.200, 550.00, 660.00), -- Свинина
(1, 19, 2.000, 65.00, 130.00),  -- Йогурт
(1, 21, 1.000, 110.00, 110.00), -- Яйца

-- Чек 2 (Попова Екатерина Григорьевна - карта 5%, сумма 3200 руб)
(2, 2, 2.000, 45.00, 90.00),    -- Хлеб Бородинский
(2, 4, 1.500, 520.00, 780.00),  -- Колбаса
(2, 6, 3.000, 35.00, 105.00),   -- Батон
(2, 8, 2.000, 450.00, 900.00),  -- Кофе
(2, 10, 3.000, 65.00, 195.00),  -- Сахар
(2, 12, 1.000, 120.00, 120.00), -- Масло подсолнечное
(2, 14, 2.500, 280.00, 700.00), -- Курица
(2, 16, 5.000, 45.00, 225.00),  -- Картофель
(2, 18, 1.000, 75.00, 75.00),   -- Сметана

-- Чек 3 (Анонимный покупатель, сумма 875 руб)
(3, 1, 1.000, 67.00, 67.00),    -- Молоко
(3, 2, 1.000, 45.00, 45.00),    -- Хлеб Бородинский
(3, 6, 2.000, 35.00, 70.00),    -- Батон
(3, 11, 1.000, 20.00, 20.00),   -- Соль
(3, 17, 3.000, 40.00, 120.00),  -- Морковь
(3, 19, 3.000, 65.00, 195.00),  -- Йогурт
(3, 21, 2.000, 110.00, 220.00), -- Яйца
(3, 13, 1.000, 75.00, 75.00),   -- Макароны
(3, 9, 1.000, 210.00, 210.00),  -- Чай

-- Чек 4 (Лебедева Ольга Харитоновна - карта 7%, сумма 1420 руб)
(4, 3, 0.800, 350.00, 280.00),  -- Сыр
(4, 5, 2.000, 120.00, 240.00),  -- Яблоки
(4, 7, 2.000, 95.00, 190.00),   -- Шоколад
(4, 15, 0.600, 550.00, 330.00), -- Свинина
(4, 17, 2.500, 40.00, 100.00),  -- Морковь
(4, 19, 2.000, 65.00, 130.00),  -- Йогурт
(4, 12, 1.000, 120.00, 120.00), -- Масло подсолнечное

-- Чек 5 (Кузнецов Денис Фёдорович - карта 10%, сумма 2560 руб)
(5, 4, 1.200, 520.00, 624.00),  -- Колбаса
(5, 8, 1.000, 450.00, 450.00),  -- Кофе
(5, 10, 2.000, 65.00, 130.00),  -- Сахар
(5, 14, 2.000, 280.00, 560.00), -- Курица
(5, 16, 4.000, 45.00, 180.00),  -- Картофель
(5, 18, 3.000, 75.00, 225.00),  -- Сметана
(5, 20, 2.000, 90.00, 180.00),  -- Творог
(5, 2, 2.000, 45.00, 90.00),    -- Хлеб Бородинский

-- Чек 6 (Анонимный покупатель, сумма 980 руб - должен получить карту 2%)
(6, 1, 2.000, 67.00, 134.00),   -- Молоко
(6, 6, 3.000, 35.00, 105.00),   -- Батон
(6, 11, 2.000, 20.00, 40.00),   -- Соль
(6, 13, 2.000, 75.00, 150.00),  -- Макароны
(6, 17, 2.000, 40.00, 80.00),   -- Морковь
(6, 19, 4.000, 65.00, 260.00),  -- Йогурт
(6, 21, 1.000, 110.00, 110.00), -- Яйца

-- Чек 7 (Волкова Мария Павловна - карта 6%, сумма 3150 руб)
(7, 2, 3.000, 45.00, 135.00),   -- Хлеб Бородинский
(7, 4, 1.800, 520.00, 936.00),  -- Колбаса
(7, 8, 2.000, 450.00, 900.00),  -- Кофе
(7, 12, 2.000, 120.00, 240.00), -- Масло подсолнечное
(7, 14, 1.500, 280.00, 420.00), -- Курица
(7, 16, 3.000, 45.00, 135.00),  -- Картофель
(7, 20, 3.000, 90.00, 270.00),  -- Творог

-- Чек 8 (Васильев Василий Васильевич - карта 8%, сумма 1680 руб)
(8, 3, 0.600, 350.00, 210.00),  -- Сыр
(8, 5, 1.500, 120.00, 180.00),  -- Яблоки
(8, 7, 4.000, 95.00, 380.00),   -- Шоколад
(8, 9, 2.000, 210.00, 420.00),  -- Чай
(8, 15, 0.500, 550.00, 275.00), -- Свинина
(8, 19, 2.000, 65.00, 130.00),  -- Йогурт

-- Чек 9 (Курочкин Иван Степанович - карта 12%, сумма 2240 руб)
(9, 1, 3.000, 67.00, 201.00),   -- Молоко
(9, 4, 1.000, 520.00, 520.00),  -- Колбаса
(9, 8, 1.000, 450.00, 450.00),  -- Кофе
(9, 10, 3.000, 65.00, 195.00),  -- Сахар
(9, 14, 1.800, 280.00, 504.00), -- Курица
(9, 18, 2.000, 75.00, 150.00),  -- Сметана
(9, 21, 2.000, 110.00, 220.00), -- Яйца

-- Чек 10 (Анонимный покупатель, сумма 1320 руб - должен получить карту 2%)
(10, 2, 2.000, 45.00, 90.00),   -- Хлеб Бородинский
(10, 6, 4.000, 35.00, 140.00),  -- Батон
(10, 11, 3.000, 20.00, 60.00),  -- Соль
(10, 13, 3.000, 75.00, 225.00), -- Макароны
(10, 17, 4.000, 40.00, 160.00), -- Морковь
(10, 19, 5.000, 65.00, 325.00), -- Йогурт
(10, 21, 3.000, 110.00, 330.00),-- Яйца

-- Чек 11 (Малькова Нина Валерьевна - карта 4%, сумма 2780 руб)
(11, 3, 1.200, 350.00, 420.00), -- Сыр
(11, 5, 3.000, 120.00, 360.00), -- Яблоки
(11, 7, 5.000, 95.00, 475.00),  -- Шоколад
(11, 9, 3.000, 210.00, 630.00), -- Чай
(11, 15, 1.000, 550.00, 550.00),-- Свинина
(11, 20, 2.000, 90.00, 180.00), -- Творог

-- Чек 12 (Зонтиков Георгий Романович - карта 4%, сумма 950 руб)
(12, 1, 1.000, 67.00, 67.00),   -- Молоко
(12, 2, 1.000, 45.00, 45.00),   -- Хлеб Бородинский
(12, 6, 2.000, 35.00, 70.00),   -- Батон
(12, 11, 1.000, 20.00, 20.00),  -- Соль
(12, 13, 2.000, 75.00, 150.00), -- Макароны
(12, 17, 3.000, 40.00, 120.00), -- Морковь
(12, 19, 4.000, 65.00, 260.00), -- Йогурт
(12, 21, 1.000, 110.00, 110.00),-- Яйца

-- Чек 13 (Анонимный покупатель, сумма 1860 руб - должен получить карту 2%)
(13, 4, 0.800, 520.00, 416.00), -- Колбаса
(13, 8, 1.000, 450.00, 450.00), -- Кофе
(13, 10, 2.000, 65.00, 130.00), -- Сахар
(13, 12, 1.000, 120.00, 120.00),-- Масло подсолнечное
(13, 14, 1.200, 280.00, 336.00),-- Курица
(13, 18, 2.000, 75.00, 150.00), -- Сметана
(13, 20, 1.000, 90.00, 90.00),  -- Творог

-- Чек 14 (Зайцев Станислав Сергеевич - карта 2%, сумма 3420 руб)
(14, 1, 4.000, 67.00, 268.00),  -- Молоко
(14, 3, 2.000, 350.00, 700.00), -- Сыр
(14, 5, 4.000, 120.00, 480.00), -- Яблоки
(14, 7, 6.000, 95.00, 570.00),  -- Шоколад
(14, 9, 2.000, 210.00, 420.00), -- Чай
(14, 15, 1.500, 550.00, 825.00),-- Свинина
(14, 19, 3.000, 65.00, 195.00), -- Йогурт

-- Чек 15 (Егорова Марина Георгиевна - карта 4%, сумма 1250 руб)
(15, 2, 2.000, 45.00, 90.00),   -- Хлеб Бородинский
(15, 4, 0.600, 520.00, 312.00), -- Колбаса
(15, 6, 3.000, 35.00, 105.00),  -- Батон
(15, 8, 1.000, 450.00, 450.00), -- Кофе
(15, 16, 2.000, 45.00, 90.00),  -- Картофель
(15, 18, 1.000, 75.00, 75.00),  -- Сметана
(15, 20, 1.000, 90.00, 90.00);  -- Творог